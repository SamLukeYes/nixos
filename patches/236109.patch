From 5a54b575784f168ec8b6d4f001ab23d0c26913b6 Mon Sep 17 00:00:00 2001
From: K900 <me@0upti.me>
Date: Mon, 5 Jun 2023 19:10:54 +0300
Subject: [PATCH 1/4] easysnap: don't use -n

---
 pkgs/tools/backup/easysnap/default.nix | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pkgs/tools/backup/easysnap/default.nix b/pkgs/tools/backup/easysnap/default.nix
index c9b70ee3735da..46952ce5327a3 100644
--- a/pkgs/tools/backup/easysnap/default.nix
+++ b/pkgs/tools/backup/easysnap/default.nix
@@ -13,7 +13,7 @@ stdenv.mkDerivation {
 
   installPhase = ''
     mkdir -p $out/bin
-    cp -n easysnap* $out/bin/
+    cp easysnap* $out/bin/
 
     for i in $out/bin/*; do
       substituteInPlace $i \

From afe337e62e361c8028bcf066f07d49d79abf696d Mon Sep 17 00:00:00 2001
From: K900 <me@0upti.me>
Date: Mon, 5 Jun 2023 19:13:27 +0300
Subject: [PATCH 2/4] metals: don't use cp -n

---
 pkgs/development/tools/language-servers/metals/default.nix | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pkgs/development/tools/language-servers/metals/default.nix b/pkgs/development/tools/language-servers/metals/default.nix
index f0c1e92fe0ece..20a14a0951674 100644
--- a/pkgs/development/tools/language-servers/metals/default.nix
+++ b/pkgs/development/tools/language-servers/metals/default.nix
@@ -12,7 +12,7 @@ stdenv.mkDerivation rec {
         -r bintray:scalacenter/releases \
         -r sonatype:snapshots > deps
       mkdir -p $out/share/java
-      cp -n $(< deps) $out/share/java/
+      cp $(< deps) $out/share/java/
     '';
     outputHashMode = "recursive";
     outputHashAlgo = "sha256";

From 57e1ea5a18d2c96d166a9edb341aaaeae24d0691 Mon Sep 17 00:00:00 2001
From: K900 <me@0upti.me>
Date: Mon, 5 Jun 2023 19:14:01 +0300
Subject: [PATCH 3/4] nixos/libvirtd: don't use cp -n

---
 nixos/modules/virtualisation/libvirtd.nix | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/nixos/modules/virtualisation/libvirtd.nix b/nixos/modules/virtualisation/libvirtd.nix
index 537db537279a1..8dfe04cea5427 100644
--- a/nixos/modules/virtualisation/libvirtd.nix
+++ b/nixos/modules/virtualisation/libvirtd.nix
@@ -308,7 +308,9 @@ in
             libvirt/nwfilter/*.xml );
         do
             mkdir -p /var/lib/$(dirname $i) -m 755
-            cp -npd ${cfg.package}/var/lib/$i /var/lib/$i
+            if [ ! -e /var/lib/$i ]; then
+              cp -pd ${cfg.package}/var/lib/$i /var/lib/$i
+            fi
         done
 
         # Copy generated qemu config to libvirt directory

From a91653fe7919d123c4ce5f9e668c7fd57a529152 Mon Sep 17 00:00:00 2001
From: K900 <me@0upti.me>
Date: Mon, 5 Jun 2023 12:04:53 +0300
Subject: [PATCH 4/4] composable_kernel: wat

---
 pkgs/development/libraries/composable_kernel/default.nix | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

diff --git a/pkgs/development/libraries/composable_kernel/default.nix b/pkgs/development/libraries/composable_kernel/default.nix
index e00af9a9755ee..531d5d66f3ffb 100644
--- a/pkgs/development/libraries/composable_kernel/default.nix
+++ b/pkgs/development/libraries/composable_kernel/default.nix
@@ -2,7 +2,6 @@
 , stdenv
 , fetchFromGitHub
 , unstableGitUpdater
-, runCommand
 , cmake
 , rocm-cmake
 , hip
@@ -88,9 +87,6 @@ let
     };
   });
 
-  ckProfiler = runCommand "ckProfiler" { preferLocalBuild = true; } ''
-    cp -a ${ck}/bin/ckProfiler $out
-  '';
 in stdenv.mkDerivation {
   inherit (ck) pname version outputs src passthru requiredSystemFeatures meta;
 
@@ -102,8 +98,7 @@ in stdenv.mkDerivation {
   installPhase = ''
     runHook preInstall
 
-    mkdir -p $out/bin
-    cp -as ${ckProfiler} $out/bin/ckProfiler
+    mkdir -p $out
     cp -an ${ck}/* $out
   '' + lib.optionalString buildTests ''
     cp -a ${ck.test} $test
