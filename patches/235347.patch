From d9bf21544e2623d6ab512739ddebbf3f5b7f1668 Mon Sep 17 00:00:00 2001
From: Nick Cao <nickcao@nichi.co>
Date: Thu, 1 Jun 2023 16:29:39 +0800
Subject: [PATCH] perlPackages.TextBibTeX: always install libbtparse.so to /lib
 instead of /lib64

---
 ...bTeX-use-lib-on-aarch64.patch => TextBibTeX-use-lib.patch} | 2 +-
 pkgs/top-level/perl-packages.nix                              | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)
 rename pkgs/development/perl-modules/{TextBibTeX-use-lib-on-aarch64.patch => TextBibTeX-use-lib.patch} (79%)

diff --git a/pkgs/development/perl-modules/TextBibTeX-use-lib-on-aarch64.patch b/pkgs/development/perl-modules/TextBibTeX-use-lib.patch
similarity index 79%
rename from pkgs/development/perl-modules/TextBibTeX-use-lib-on-aarch64.patch
rename to pkgs/development/perl-modules/TextBibTeX-use-lib.patch
index 42fa3728680b9..e5490ad6f1180 100644
--- a/pkgs/development/perl-modules/TextBibTeX-use-lib-on-aarch64.patch
+++ b/pkgs/development/perl-modules/TextBibTeX-use-lib.patch
@@ -5,7 +5,7 @@
  }
  else {
 -    if ( $Config{archname} =~ /^x86_64|^ppc64|^s390x|^aarch64|^riscv64/ ) {
-+    if ( $Config{archname} =~ /^x86_64|^ppc64|^s390x|^riscv64/ ) {
++    if ( 0 ) {
          $libdir =~ s/\bbin\b/lib64/;
          if ( !-d $libdir ) {
              my $test = $libdir;
diff --git a/pkgs/top-level/perl-packages.nix b/pkgs/top-level/perl-packages.nix
index d1f8186792898..401a5f9705af0 100644
--- a/pkgs/top-level/perl-packages.nix
+++ b/pkgs/top-level/perl-packages.nix
@@ -25171,8 +25171,8 @@ with self; {
       url = "mirror://cpan/authors/id/A/AM/AMBS/Text-BibTeX-0.88.tar.gz";
       hash = "sha256-sBRYbmi9vK+wos+gQB6woE6l3oxNW8Nt0Pf66ras9Cw=";
     };
-    # libbtparse.so: cannot open shared object file (aarch64 only)
-    patches = [ ../development/perl-modules/TextBibTeX-use-lib-on-aarch64.patch ];
+    # libbtparse.so: cannot open shared object file
+    patches = [ ../development/perl-modules/TextBibTeX-use-lib.patch ];
     perlPreHook = "export LD=$CC";
     perlPostHook = lib.optionalString stdenv.isDarwin ''
       oldPath="$(pwd)/btparse/src/libbtparse.dylib"
